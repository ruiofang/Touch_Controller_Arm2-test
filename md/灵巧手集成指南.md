# 灵巧手集成指南

## 概述

本项目已成功集成了linker_hand_python_sdk，实现了末端夹取功能的灵巧手控制。

## 功能特性

### 1. 双模式控制
- **夹爪模式**: 传统的机械臂夹爪控制
- **灵巧手模式**: 使用LinkerHand SDK的灵巧手控制

### 2. 支持的灵巧手型号
- L7 (7关节)
- L10 (10关节) 
- L20 (20关节)
- L25 (25关节)

### 3. 配置灵活性
- 支持左手/右手配置
- 可配置CAN总线接口
- 可自定义抓取和松开动作名称

## 配置说明

### 配置文件位置
- 主配置: `config.ini`
- 动作配置: `linker_hand_python_sdk/LinkerHand/config/L7_positions.yaml`

### 主要配置项

#### Device1 (设备1) 灵巧手配置
```ini
[device1_mapping]
# 启用灵巧手控制
use_dexterous_hand = true

# 灵巧手类型 (left/right)
hand_type = left

# 灵巧手关节类型 (L7/L10/L20/L25)
hand_joint = L7

# CAN总线接口
can_interface = can0

# 抓取动作名称
grasp_action = ZQ

# 松开动作名称  
release_action = 张开
```

#### Device2 (设备2) 灵巧手配置
```ini
[device2_mapping]
# 启用灵巧手控制  
use_dexterous_hand = false  # 当前为夹爪模式

# 如需启用灵巧手，可配置为:
# use_dexterous_hand = true
# hand_type = right
# hand_joint = L7
# can_interface = can1
# grasp_action = ZQ
# release_action = 张开
```

### 动作配置 (L7_positions.yaml)

#### 左手动作
```yaml
LEFT_HAND:
- ACTION_NAME: ZQ
  POSITION:
  - 125
  - 170
  - 149
  - 150
  - 0
  - 0
  - 44
- ACTION_NAME: 张开
  POSITION:
  - 255
  - 70
  - 255
  - 255
  - 255
  - 255
  - 255
```

#### 右手动作
```yaml
RIGHT_HAND:
- ACTION_NAME: ZQ
  POSITION:
  - 125
  - 170
  - 149
  - 150
  - 0
  - 0
  - 44
- ACTION_NAME: 张开
  POSITION:
  - 255.0
  - 70.0
  - 255.0
  - 255.0
  - 255.0
  - 255.0
  - 255.0
```

## 操作说明

### 1. 系统启动
```bash
# 确保CAN总线已配置
sudo modprobe can
sudo modprobe can_raw
sudo modprobe vcan

# 启动程序
./run2.sh
```

### 2. 控制方式
- **按钮1**: 控制机械臂位置和姿态
- **按钮2**: 控制末端夹取
  - 如果配置为灵巧手模式：在抓取(ZQ)和张开状态间切换
  - 如果配置为夹爪模式：控制夹爪开合

### 3. 状态显示
程序会显示当前的控制模式和状态：
```
[device1] 正在初始化灵巧手...
   手型: left
   关节: L7
   CAN接口: can0
   抓取动作: ZQ
   松开动作: 张开
✅ 灵巧手控制器初始化成功
```

## 技术实现

### 1. C++与Python集成
- 使用Python C API调用LinkerHand SDK
- 实现了DexterousHandController类进行封装
- 支持动态配置和实时控制

### 2. 错误处理
- 初始化失败自动降级到夹爪模式
- 详细的错误日志和状态提示
- 容错机制确保系统稳定运行

### 3. 内存管理
- 正确的Python对象引用计数管理
- 程序退出时自动清理资源

## 故障排除

### 1. CAN总线问题
```bash
# 检查CAN接口状态
ip link show can0

# 重新配置CAN接口
sudo ip link set can0 down
sudo ip link set can0 type can bitrate 1000000
sudo ip link set can0 up
```

### 2. Python环境问题
```bash
# 检查Python路径
python3 -c "import sys; print(sys.path)"

# 安装依赖
cd linker_hand_python_sdk
pip3 install -r requirements.txt
```

### 3. 权限问题
```bash
# 添加用户到dialout组
sudo usermod -a -G dialout $USER

# 重启后生效或使用
newgrp dialout
```

## 扩展开发

### 1. 添加新动作
1. 在对应的positions.yaml文件中添加新动作
2. 更新配置文件中的动作名称
3. 重启程序即可使用

### 2. 支持更多手型
1. 确保linker_hand_python_sdk支持目标手型
2. 更新配置文件中的hand_joint设置
3. 调整相应的关节数量参数

### 3. 自定义控制逻辑
可在TouchArmController::onGripperButtonPressed()方法中添加自定义控制逻辑。

## 版本信息

- LinkerHand SDK版本: 2.1.7
- 支持的系统: Ubuntu 20.04+
- Python版本: 3.8+
- 编译器: GCC 9.0+

## 联系支持

如遇问题请检查:
1. 配置文件格式是否正确
2. CAN总线是否正常工作
3. 硬件连接是否正确
4. 权限设置是否合适
