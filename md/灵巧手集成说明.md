# 灵巧手末端控制集成说明

## 概述

本项目已成功集成linker_hand_python_sdk，实现了双Touch设备分别控制两个灵巧手的功能。每个Touch设备的按钮2可以控制对应的灵巧手进行抓取和松开操作。

## 功能特点

### ✅ 已完成的功能

1. **双灵巧手支持**
   - 设备1（Touch设备1）控制左手灵巧手
   - 设备2（Touch设备2）控制右手灵巧手

2. **配置化动作控制**
   - 支持通过配置文件自定义抓取和松开动作
   - 使用linker_hand_python_sdk的YAML配置文件中定义的动作名称
   - 默认使用"ZQ"作为抓取动作，"张开"作为松开动作

3. **多手型支持**
   - L7（7关节）
   - L10（10关节）
   - L20（20关节）
   - L25（25关节）

4. **CAN总线配置**
   - 支持多CAN接口（can0, can1, can2等）
   - 每个设备可独立配置CAN接口

## 配置说明

### config.ini配置文件

#### 设备1灵巧手配置（device1_mapping节）
```ini
[device1_mapping]
# ... 其他映射配置 ...

# 设备1灵巧手配置
use_dexterous_hand = true         # 启用灵巧手控制
hand_type = left                  # 手型：left/right
hand_joint = L7                   # 关节类型：L7/L10/L20/L25
can_interface = can0              # CAN总线接口
grasp_action = ZQ                 # 抓取动作名称
release_action = 张开             # 松开动作名称
```

#### 设备2灵巧手配置（device2_mapping节）
```ini
[device2_mapping]
# ... 其他映射配置 ...

# 设备2灵巧手配置
use_dexterous_hand = true         # 启用灵巧手控制
hand_type = right                 # 手型：left/right
hand_joint = L7                   # 关节类型：L7/L10/L20/L25
can_interface = can1              # CAN总线接口
grasp_action = ZQ                 # 抓取动作名称
release_action = 张开             # 松开动作名称
```

### 动作配置文件

动作配置存储在 `linker_hand_python_sdk/LinkerHand/config/` 目录下：

- `L7_positions.yaml` - L7手型动作配置
- `L10_positions.yaml` - L10手型动作配置
- `L20_positions.yaml` - L20手型动作配置
- `L25_positions.yaml` - L25手型动作配置

#### L7_positions.yaml示例
```yaml
LEFT_HAND:
- ACTION_NAME: ZQ
  POSITION:
  - 125
  - 170
  - 149
  - 150
  - 0
  - 0
  - 44
- ACTION_NAME: 张开
  POSITION:
  - 255
  - 179
  - 255
  - 255
  - 255
  - 255
  - 83

RIGHT_HAND:
- ACTION_NAME: ZQ
  POSITION:
  - 125.0
  - 170.0
  - 149.0
  - 150.0
  - 0.0
  - 0.0
  - 44.0
- ACTION_NAME: 张开
  POSITION:
  - 255.0
  - 70.0
  - 255.0
  - 255.0
  - 255.0
  - 255.0
  - 255.0
```

## 操作说明

### 按钮控制
- **Touch设备1按钮2**：控制左手灵巧手抓取/松开
- **Touch设备2按钮2**：控制右手灵巧手抓取/松开

### 状态切换
- 第一次按下按钮2：执行抓取动作（ZQ）
- 第二次按下按钮2：执行松开动作（张开）
- 循环切换

### 控制台输出
程序会在控制台显示详细的灵巧手状态信息：
```
=== 灵巧手控制 ===
[device1] 按钮2按下 - 切换灵巧手状态
灵巧手状态: 张开 → 握拳
✊ 灵巧手握拳 (ZQ)
当前灵巧手状态: 握拳
==================
```

## 编译和运行

### 编译主程序
```bash
make clean
make
```

### 编译测试程序
```bash
make test_hand_integration
```

### 运行测试
```bash
./test_hand_integration
```

### 运行主程序
```bash
./Touch_Controller_Arm2
```

## 系统要求

### 硬件要求
- 支持的灵巧手（L7/L10/L20/L25）
- CAN总线接口
- Touch触觉设备

### 软件要求
- Python 3.x
- linker_hand_python_sdk
- OpenHaptics 3.4
- 必要的Python库：
  - yaml
  - 其他linker_hand_python_sdk依赖库

### CAN总线配置
在运行程序前，确保CAN总线已正确配置：
```bash
# 启动CAN0接口
sudo ip link set can0 type can bitrate 1000000
sudo ip link set up can0

# 启动CAN1接口（如果使用双手）
sudo ip link set can1 type can bitrate 1000000
sudo ip link set up can1
```

## 故障排除

### 常见问题

1. **Python模块导入失败**
   - 确保linker_hand_python_sdk路径正确
   - 检查Python环境和依赖库

2. **CAN接口初始化失败**
   - 检查CAN总线硬件连接
   - 确认CAN接口已启动
   - 验证CAN接口名称配置

3. **动作配置加载失败**
   - 检查YAML配置文件格式
   - 确认动作名称拼写正确
   - 验证手型（left/right）和关节类型配置

4. **灵巧手不响应**
   - 检查灵巧手硬件连接
   - 确认CAN总线通信正常
   - 检查动作位置数据是否合理

### 调试模式
程序包含详细的调试输出，可以通过控制台信息了解运行状态和错误原因。

## 扩展功能

### 自定义动作
可以通过修改YAML配置文件添加更多自定义动作：
1. 在对应的手型配置文件中添加新的ACTION_NAME和POSITION
2. 在config.ini中修改grasp_action或release_action配置
3. 重启程序

### 多手型支持
程序支持在运行时切换不同的手型配置，只需修改config.ini中的hand_joint参数。

## 版本信息
- 灵巧手集成版本：1.0.0
- 基于Touch_Controller_Arm2项目
- 集成linker_hand_python_sdk
- 支持双设备双灵巧手控制
